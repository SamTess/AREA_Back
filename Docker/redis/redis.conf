# ============================================
# Redis Configuration - AREA Backend
# Security Hardened Configuration
# ============================================

# Bind to all interfaces within Docker network
# Redis is protected by Docker network isolation and password authentication
# Note: In Docker, we bind to 0.0.0.0 to allow other containers to connect
# External access is prevented by NOT exposing the port to the host
bind 0.0.0.0 ::

# Enable protected mode
# Prevents access from external networks when no password is set
protected-mode yes

# Require password authentication
# Password is set via environment variable
requirepass ${REDIS_PASSWORD}

# ============================================
# Security: Disable Dangerous Commands
# ============================================

# Prevent database destruction
rename-command FLUSHDB ""
rename-command FLUSHALL ""

# Prevent configuration changes
rename-command CONFIG ""

# Prevent debugging commands
rename-command DEBUG ""

# Prevent Lua script execution
rename-command EVAL ""
rename-command EVALSHA ""

# Prevent shutdown
rename-command SHUTDOWN ""

# Prevent key scanning (use SCAN instead)
# rename-command KEYS ""  # Commented out for backward compatibility

# ============================================
# Performance and Persistence
# ============================================

# Maximum memory policy
maxmemory 256mb
maxmemory-policy allkeys-lru

# Persistence - RDB Snapshots
save 900 1
save 300 10
save 60 10000

# AOF (Append Only File) for durability
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec

# ============================================
# Network and Connection Settings
# ============================================

# Maximum number of clients
maxclients 10000

# Timeout for idle clients (0 = disabled)
timeout 300

# TCP keepalive
tcp-keepalive 300

# ============================================
# Logging
# ============================================

# Log level: debug, verbose, notice, warning
loglevel notice

# Log file location (empty string = stdout)
logfile ""

# ============================================
# Slow Log Configuration
# ============================================

# Log queries slower than (microseconds)
slowlog-log-slower-than 10000

# Maximum slow log entries
slowlog-max-len 128

# ============================================
# Security: Additional Settings
# ============================================

# Disable replication if not needed
# repl-disable-tcp-nodelay no

# Enable keyspace notifications for monitoring (optional)
notify-keyspace-events ""

# ============================================
# TLS/SSL Configuration (if using SSL)
# Uncomment and configure if using Redis with TLS
# ============================================

# port 0
# tls-port 6379
# tls-cert-file /path/to/redis.crt
# tls-key-file /path/to/redis.key
# tls-ca-cert-file /path/to/ca.crt
# tls-auth-clients no
# tls-replication yes
# tls-cluster yes
