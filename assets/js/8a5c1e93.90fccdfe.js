"use strict";(globalThis.webpackChunkdocusaurus=globalThis.webpackChunkdocusaurus||[]).push([[6148],{8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>c});var s=i(6540);const r={},t=s.createContext(r);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:n},e.children)}},8951:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"worker/area-reaction-worker","title":"AREA Reaction Worker System","description":"Overview","source":"@site/docs/worker/area-reaction-worker.md","sourceDirName":"worker","slug":"/worker/area-reaction-worker","permalink":"/docs/worker/area-reaction-worker","draft":false,"unlisted":false,"editUrl":"https://github.com/SamTess/AREA_Back/tree/main/docusaurus/docs/worker/area-reaction-worker.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"AREA Worker System Documentation","permalink":"/docs/worker/"},"next":{"title":"AREA Worker System - Quick Start Guide","permalink":"/docs/worker/quick-start-worker"}}');var r=i(4848),t=i(8453);const l={},c="AREA Reaction Worker System",a={},d=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Components",id:"components",level:3},{value:"Core Features",id:"core-features",level:2},{value:"\u2705 Implemented Features",id:"-implemented-features",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Redis Configuration",id:"redis-configuration",level:3},{value:"Worker Configuration",id:"worker-configuration",level:3},{value:"Async Configuration",id:"async-configuration",level:3},{value:"Usage",id:"usage",level:2},{value:"1. Publishing Events to Worker",id:"1-publishing-events-to-worker",level:3},{value:"2. Creating Executions",id:"2-creating-executions",level:3},{value:"3. Monitoring Worker Status",id:"3-monitoring-worker-status",level:3},{value:"Get Worker Status",id:"get-worker-status",level:4},{value:"Get Execution Statistics",id:"get-execution-statistics",level:4},{value:"Get Redis Stream Information",id:"get-redis-stream-information",level:4},{value:"4. Manual Worker Operations",id:"4-manual-worker-operations",level:3},{value:"Cancel an Execution",id:"cancel-an-execution",level:4},{value:"Send Test Event",id:"send-test-event",level:4},{value:"Initialize Redis Stream",id:"initialize-redis-stream",level:4},{value:"Database Schema",id:"database-schema",level:2},{value:"Executions Table (<code>a_executions</code>)",id:"executions-table-a_executions",level:3},{value:"Execution Statuses",id:"execution-statuses",level:3},{value:"Reaction Execution",id:"reaction-execution",level:2},{value:"Current Implementation",id:"current-implementation",level:3},{value:"Example Output",id:"example-output",level:3},{value:"Retry Management",id:"retry-management",level:2},{value:"Retry Strategy",id:"retry-strategy",level:3},{value:"Retry Schedule Example",id:"retry-schedule-example",level:3},{value:"Non-Retryable Errors",id:"non-retryable-errors",level:3},{value:"Scaling and Performance",id:"scaling-and-performance",level:2},{value:"Horizontal Scaling",id:"horizontal-scaling",level:3},{value:"Performance Characteristics",id:"performance-characteristics",level:3},{value:"Monitoring and Observability",id:"monitoring-and-observability",level:2},{value:"Logs",id:"logs",level:3},{value:"Health Checks",id:"health-checks",level:3},{value:"Testing",id:"testing",level:2},{value:"Unit Tests",id:"unit-tests",level:3},{value:"Integration Tests",id:"integration-tests",level:3},{value:"Running Tests",id:"running-tests",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"Worker Not Processing Events",id:"worker-not-processing-events",level:4},{value:"High Retry Rate",id:"high-retry-rate",level:4},{value:"Memory Issues",id:"memory-issues",level:4},{value:"Debug Commands",id:"debug-commands",level:3},{value:"Development",id:"development",level:2},{value:"Adding New Reaction Types",id:"adding-new-reaction-types",level:3},{value:"Configuration for Production",id:"configuration-for-production",level:3},{value:"Roadmap",id:"roadmap",level:2},{value:"Future Enhancements",id:"future-enhancements",level:3},{value:"API Reference",id:"api-reference",level:2},{value:"WorkerController Endpoints",id:"workercontroller-endpoints",level:3},{value:"RedisEventService Methods",id:"rediseventservice-methods",level:3},{value:"ExecutionService Methods",id:"executionservice-methods",level:3},{value:"Contributing",id:"contributing",level:2},{value:"License",id:"license",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"area-reaction-worker-system",children:"AREA Reaction Worker System"})}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"The AREA Reaction Worker is a distributed, fault-tolerant system designed to execute AREA reactions asynchronously. It decouples webhook triggers and polling mechanisms from the actual reaction execution, ensuring scalability and reliability."}),"\n",(0,r.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Webhooks/     \u2502    \u2502    Redis     \u2502    \u2502  AREA Reaction  \u2502    \u2502   Database   \u2502\n\u2502   Pollers       \u2502\u2500\u2500\u2500\u25b6\u2502   Stream     \u2502\u2500\u2500\u2500\u25b6\u2502    Worker       \u2502\u2500\u2500\u2500\u25b6\u2502 (Executions) \u2502\n\u2502                 \u2502    \u2502              \u2502    \u2502                 \u2502    \u2502              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(n.h3,{id:"components",children:"Components"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Redis Stream"})," (",(0,r.jsx)(n.code,{children:"areas:events"}),"): Message queue for execution events"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"AreaReactionWorker"}),": Main worker consuming from Redis stream"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ReactionExecutor"}),": Executes individual reactions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ExecutionService"}),": Manages execution lifecycle in database"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"RetryManager"}),": Handles retry logic with exponential backoff"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"core-features",children:"Core Features"}),"\n",(0,r.jsx)(n.h3,{id:"-implemented-features",children:"\u2705 Implemented Features"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Redis Stream Processing"}),": Consumes events from ",(0,r.jsx)(n.code,{children:"areas:events"})," stream"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Multiple Processing Modes"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Real-time event processing from Redis stream"}),"\n",(0,r.jsx)(n.li,{children:"Batch processing of queued executions"}),"\n",(0,r.jsx)(n.li,{children:"Retry processing with exponential backoff"}),"\n",(0,r.jsx)(n.li,{children:"Timeout cleanup for stalled executions"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Fault Tolerance"}),": Automatic retries with exponential backoff (max 5 attempts)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Database Integration"}),": Complete execution tracking with status, logs, and timestamps"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Monitoring"}),": REST API for worker status and execution statistics"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Async Processing"}),": Separate thread pools for worker and reaction execution"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Comprehensive Testing"}),": Unit and integration tests with Testcontainers"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsx)(n.h3,{id:"redis-configuration",children:"Redis Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# application.yml\nspring:\n  redis:\n    host: localhost\n    port: 6379\n    password: ${REDIS_PASSWORD:}\n  cache:\n    type: redis\n"})}),"\n",(0,r.jsx)(n.h3,{id:"worker-configuration",children:"Worker Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["The worker uses the following constants (configurable in ",(0,r.jsx)(n.code,{children:"RedisConfig"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'public static final String AREAS_EVENTS_STREAM = "areas:events";\npublic static final String AREAS_CONSUMER_GROUP = "area-processors";\nprivate static final int STREAM_BATCH_SIZE = 10;\nprivate static final int STREAM_THREAD_POOL_SIZE = 4;\n'})}),"\n",(0,r.jsx)(n.h3,{id:"async-configuration",children:"Async Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["Thread pools are configured in ",(0,r.jsx)(n.code,{children:"AsyncConfig"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// Worker pool for scheduled tasks\n@Bean(name = "areaWorkerExecutor")\n- Core pool size: 4\n- Max pool size: 10\n- Queue capacity: 100\n\n// Reaction execution pool\n@Bean(name = "reactionTaskExecutor") \n- Core pool size: 2\n- Max pool size: 6\n- Queue capacity: 50\n'})}),"\n",(0,r.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,r.jsx)(n.h3,{id:"1-publishing-events-to-worker",children:"1. Publishing Events to Worker"}),"\n",(0,r.jsxs)(n.p,{children:["Events are published to the Redis stream via ",(0,r.jsx)(n.code,{children:"RedisEventService"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@Autowired\nprivate RedisEventService redisEventService;\n\n// Publish an execution event\nString eventId = redisEventService.publishExecutionEvent(\n    executionId,           // UUID of the execution\n    actionInstanceId,      // UUID of the action instance\n    areaId,               // UUID of the AREA\n    payload               // Map<String, Object> event payload\n);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-creating-executions",children:"2. Creating Executions"}),"\n",(0,r.jsxs)(n.p,{children:["Create executions in the database using ",(0,r.jsx)(n.code,{children:"ExecutionService"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@Autowired\nprivate ExecutionService executionService;\n\nExecution execution = executionService.createExecution(\n    actionInstance,        // ActionInstance entity\n    activationMode,        // ActivationMode entity (can be null)\n    inputPayload,         // Map<String, Object> input data\n    correlationId         // UUID for grouping related executions\n);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-monitoring-worker-status",children:"3. Monitoring Worker Status"}),"\n",(0,r.jsx)(n.h4,{id:"get-worker-status",children:"Get Worker Status"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"GET /api/worker/status\n"})}),"\n",(0,r.jsx)(n.p,{children:"Response:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "consumerName": "worker-a1b2c3d4",\n  "running": true,\n  "streamInfo": {\n    "streamKey": "areas:events",\n    "consumerGroup": "area-processors",\n    "streamInfo": "..."\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"get-execution-statistics",children:"Get Execution Statistics"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"GET /api/worker/statistics\n"})}),"\n",(0,r.jsx)(n.p,{children:"Response:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "queued": 5,\n  "running": 2,\n  "ok": 150,\n  "retry": 3,\n  "failed": 2,\n  "canceled": 1\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"get-redis-stream-information",children:"Get Redis Stream Information"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"GET /api/worker/stream-info\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-manual-worker-operations",children:"4. Manual Worker Operations"}),"\n",(0,r.jsx)(n.h4,{id:"cancel-an-execution",children:"Cancel an Execution"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"POST /api/worker/executions/{executionId}/cancel?reason=Manual+cancellation\n"})}),"\n",(0,r.jsx)(n.h4,{id:"send-test-event",children:"Send Test Event"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"POST /api/worker/test-event?actionInstanceId={uuid}&areaId={uuid}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"initialize-redis-stream",children:"Initialize Redis Stream"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"POST /api/worker/initialize-stream\n"})}),"\n",(0,r.jsx)(n.h2,{id:"database-schema",children:"Database Schema"}),"\n",(0,r.jsxs)(n.h3,{id:"executions-table-a_executions",children:["Executions Table (",(0,r.jsx)(n.code,{children:"a_executions"}),")"]}),"\n",(0,r.jsx)(n.p,{children:"The worker tracks all executions in the database:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE a_executions (\n  id                   uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  action_instance_id   uuid NOT NULL REFERENCES a_action_instances(id),\n  activation_mode_id   uuid REFERENCES a_activation_modes(id),\n  area_id              uuid REFERENCES a_areas(id),\n  status               execution_status NOT NULL DEFAULT 'QUEUED',\n  attempt              integer NOT NULL DEFAULT 0,\n  queued_at            timestamptz NOT NULL DEFAULT now(),\n  started_at           timestamptz,\n  finished_at          timestamptz,\n  input_payload        jsonb,\n  output_payload       jsonb,\n  error                jsonb,\n  correlation_id       uuid,\n  dedup_key            text\n);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"execution-statuses",children:"Execution Statuses"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"QUEUED"}),": Execution is waiting to be processed"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"RUNNING"}),": Execution is currently being processed"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"OK"}),": Execution completed successfully"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"RETRY"}),": Execution failed but will be retried"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"FAILED"}),": Execution failed permanently (max retries reached)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CANCELED"}),": Execution was manually canceled"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"reaction-execution",children:"Reaction Execution"}),"\n",(0,r.jsx)(n.h3,{id:"current-implementation",children:"Current Implementation"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"ReactionExecutor"})," currently provides ",(0,r.jsx)(n.strong,{children:"simulated/mocked"})," executions for different service types:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Email"}),": Simulates email sending with latency (200-800ms)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Slack"}),": Simulates Slack message posting (300-1000ms)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Webhook"}),": Simulates HTTP webhook calls (500-1500ms)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Database"}),": Simulates database operations (100-500ms)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Notification"}),": Simulates push notifications (150-600ms)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Generic"}),": Default simulation for unknown services (200-1000ms)"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"example-output",children:"Example Output"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "service": "email",\n  "action": "send_email",\n  "executedAt": "2025-09-30T10:30:00",\n  "executionDuration": "456ms",\n  "type": "email",\n  "to": "user@example.com",\n  "subject": "AREA Notification",\n  "status": "sent",\n  "messageId": "msg_a1b2c3d4"\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"retry-management",children:"Retry Management"}),"\n",(0,r.jsx)(n.h3,{id:"retry-strategy",children:"Retry Strategy"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"RetryManager"})," implements intelligent retry logic:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Maximum Attempts"}),": 5 retries"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Exponential Backoff"}),": ",(0,r.jsx)(n.code,{children:"2^attempt"})," seconds (with jitter)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Maximum Delay"}),": 300 seconds"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Jitter"}),": \xb110% random variation to prevent thundering herd"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"retry-schedule-example",children:"Retry Schedule Example"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Attempt"}),(0,r.jsx)(n.th,{children:"Base Delay"}),(0,r.jsx)(n.th,{children:"Actual Delay (with jitter)"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"1"}),(0,r.jsx)(n.td,{children:"2s"}),(0,r.jsx)(n.td,{children:"1.8s - 2.2s"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"2"}),(0,r.jsx)(n.td,{children:"4s"}),(0,r.jsx)(n.td,{children:"3.6s - 4.4s"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"3"}),(0,r.jsx)(n.td,{children:"8s"}),(0,r.jsx)(n.td,{children:"7.2s - 8.8s"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"4"}),(0,r.jsx)(n.td,{children:"16s"}),(0,r.jsx)(n.td,{children:"14.4s - 17.6s"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"5"}),(0,r.jsx)(n.td,{children:"32s"}),(0,r.jsx)(n.td,{children:"28.8s - 35.2s"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"non-retryable-errors",children:"Non-Retryable Errors"}),"\n",(0,r.jsxs)(n.p,{children:["The following error types are ",(0,r.jsx)(n.strong,{children:"not retried"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Authentication/Authorization errors"}),"\n",(0,r.jsx)(n.li,{children:"Validation errors (bad request)"}),"\n",(0,r.jsx)(n.li,{children:"Resource not found errors"}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"IllegalArgumentException"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"SecurityException"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"scaling-and-performance",children:"Scaling and Performance"}),"\n",(0,r.jsx)(n.h3,{id:"horizontal-scaling",children:"Horizontal Scaling"}),"\n",(0,r.jsx)(n.p,{children:"The worker system supports horizontal scaling:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Multiple Worker Instances"}),": Each worker has a unique consumer name"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Consumer Groups"}),": Redis streams distribute work across consumers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Load Balancing"}),": Events are automatically distributed among available workers"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"performance-characteristics",children:"Performance Characteristics"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Throughput"}),": Processes ~10-50 executions/second per worker instance"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Latency"}),": Typical execution time 100ms-2s (depending on service)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Memory"}),": ~50-100MB per worker instance"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Redis"}),": Lightweight message overhead (~1KB per event)"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"monitoring-and-observability",children:"Monitoring and Observability"}),"\n",(0,r.jsx)(n.h3,{id:"logs",children:"Logs"}),"\n",(0,r.jsx)(n.p,{children:"The worker provides structured logging:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-log",children:"2025-09-30 10:30:15.123 INFO  AreaReactionWorker - Processing execution: id=123, actionInstance=456, attempt=1\n2025-09-30 10:30:15.580 INFO  AreaReactionWorker - Completed execution: id=123, status=OK, duration=457ms\n"})}),"\n",(0,r.jsx)(n.h3,{id:"health-checks",children:"Health Checks"}),"\n",(0,r.jsx)(n.p,{children:"Worker health can be monitored via:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/api/worker/status"})," - Worker operational status"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/actuator/health"})," - Spring Boot health endpoint"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/actuator/caches"})," - Redis cache status"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,r.jsx)(n.h3,{id:"unit-tests",children:"Unit Tests"}),"\n",(0,r.jsx)(n.p,{children:"Comprehensive unit tests cover:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"AreaReactionWorkerTest"}),": Worker logic and error handling"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ReactionExecutorTest"}),": Reaction execution scenarios"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"RetryManagerTest"}),": Retry logic and backoff calculation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ExecutionServiceTest"}),": Database operations"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"integration-tests",children:"Integration Tests"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"WorkerIntegrationTest"})," provides end-to-end testing:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Real Redis instance (via Testcontainers)"}),"\n",(0,r.jsx)(n.li,{children:"Full workflow: Event \u2192 Redis \u2192 Worker \u2192 Database"}),"\n",(0,r.jsx)(n.li,{children:"Performance and reliability testing"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"running-tests",children:"Running Tests"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Unit tests only\n./gradlew test\n\n# Integration tests (requires Docker)\n./gradlew integrationTest\n\n# All tests\n./gradlew check\n"})}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,r.jsx)(n.h4,{id:"worker-not-processing-events",children:"Worker Not Processing Events"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Check Redis Connection"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"redis-cli ping\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Verify Stream Exists"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"redis-cli XINFO STREAM areas:events\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Check Consumer Group"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"redis-cli XINFO GROUPS areas:events\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"high-retry-rate",children:"High Retry Rate"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Check Error Patterns"})," in execution logs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Review Service Configurations"})," (timeouts, credentials)"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Monitor External Service Health"})}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"memory-issues",children:"Memory Issues"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Monitor Thread Pool Usage"})," via ",(0,r.jsx)(n.code,{children:"/actuator/metrics"})]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Check Redis Memory Usage"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Review Execution Payload Sizes"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"debug-commands",children:"Debug Commands"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check Redis stream length\nredis-cli XLEN areas:events\n\n# View recent events\nredis-cli XRANGE areas:events - + COUNT 10\n\n# Check consumer group status\nredis-cli XINFO CONSUMERS areas:events area-processors\n\n# Monitor Redis operations\nredis-cli MONITOR\n"})}),"\n",(0,r.jsx)(n.h2,{id:"development",children:"Development"}),"\n",(0,r.jsx)(n.h3,{id:"adding-new-reaction-types",children:"Adding New Reaction Types"}),"\n",(0,r.jsx)(n.p,{children:"To add support for a new service type:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Extend ReactionExecutor"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"private Map<String, Object> executeNewServiceAction(String actionKey, \n                                                   Map<String, Object> input,\n                                                   Map<String, Object> params) {\n    // Implement actual service integration\n    // Return execution result\n}\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Add to Service Switch"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'case "newservice":\n    result.putAll(executeNewServiceAction(actionKey, inputPayload, actionParams));\n    break;\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Add Tests"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@Test\nvoid testNewServiceExecution() {\n    // Test the new service integration\n}\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"configuration-for-production",children:"Configuration for Production"}),"\n",(0,r.jsx)(n.p,{children:"For production deployment:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Enable Connection Pooling"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spring:\n  redis:\n    lettuce:\n      pool:\n        max-active: 8\n        max-idle: 8\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Configure Monitoring"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"management:\n  endpoints:\n    web:\n      exposure:\n        include: health,metrics,caches\n  metrics:\n    export:\n      prometheus:\n        enabled: true\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Set Production Logging"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"logging:\n  level:\n    area.server.AREA_Back.worker: INFO\n    org.springframework.data.redis: WARN\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"roadmap",children:"Roadmap"}),"\n",(0,r.jsx)(n.h3,{id:"future-enhancements",children:"Future Enhancements"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Real Service Integrations"}),": Replace simulations with actual API clients"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Dead Letter Queue"}),": Implement automatic dead letter processing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Metrics & Tracing"}),": Add Prometheus metrics and distributed tracing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Rate Limiting"}),": Per-service rate limiting and throttling"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Webhook Integration"}),": Connect webhook receivers to worker system"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Configuration UI"}),": Admin interface for worker configuration"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"api-reference",children:"API Reference"}),"\n",(0,r.jsx)(n.h3,{id:"workercontroller-endpoints",children:"WorkerController Endpoints"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Method"}),(0,r.jsx)(n.th,{children:"Endpoint"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"GET"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/api/worker/status"})}),(0,r.jsx)(n.td,{children:"Get worker operational status"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"GET"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/api/worker/statistics"})}),(0,r.jsx)(n.td,{children:"Get execution statistics"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"GET"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/api/worker/stream-info"})}),(0,r.jsx)(n.td,{children:"Get Redis stream information"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"POST"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/api/worker/executions/{id}/cancel"})}),(0,r.jsx)(n.td,{children:"Cancel specific execution"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"POST"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/api/worker/test-event"})}),(0,r.jsx)(n.td,{children:"Send test event to worker"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"POST"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/api/worker/initialize-stream"})}),(0,r.jsx)(n.td,{children:"Initialize Redis stream"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"rediseventservice-methods",children:"RedisEventService Methods"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Method"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"publishAreaEvent(message)"})}),(0,r.jsx)(n.td,{children:"Publish event to Redis stream"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"publishExecutionEvent(...)"})}),(0,r.jsx)(n.td,{children:"Publish execution event"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"initializeStream()"})}),(0,r.jsx)(n.td,{children:"Initialize stream and consumer group"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"getStreamInfo()"})}),(0,r.jsx)(n.td,{children:"Get stream status information"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"executionservice-methods",children:"ExecutionService Methods"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Method"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"createExecution(...)"})}),(0,r.jsx)(n.td,{children:"Create new execution in database"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"updateExecutionWithResult(...)"})}),(0,r.jsx)(n.td,{children:"Update execution with result"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"markExecutionAsStarted(...)"})}),(0,r.jsx)(n.td,{children:"Mark execution as started"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"getQueuedExecutions()"})}),(0,r.jsx)(n.td,{children:"Get executions waiting to be processed"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"getExecutionsReadyForRetry(...)"})}),(0,r.jsx)(n.td,{children:"Get executions ready for retry"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"cancelExecution(...)"})}),(0,r.jsx)(n.td,{children:"Cancel execution manually"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"getExecutionStatistics()"})}),(0,r.jsx)(n.td,{children:"Get execution statistics"})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"contributing",children:"Contributing"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Fork the repository"}),"\n",(0,r.jsx)(n.li,{children:"Create a feature branch"}),"\n",(0,r.jsx)(n.li,{children:"Add tests for new functionality"}),"\n",(0,r.jsx)(n.li,{children:"Ensure all tests pass"}),"\n",(0,r.jsx)(n.li,{children:"Submit a pull request"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"license",children:"License"}),"\n",(0,r.jsx)(n.p,{children:"This project is licensed under the MIT License."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}}}]);